set(CPM_DOWNLOAD_VERSION 0.38.1)
set(CPM_DOWNLOAD_VERSION_CACHE ${CPM_DOWNLOAD_VERSION} CACHE STRING "CPM.cmake version")
if(NOT ${CPM_DOWNLOAD_VERSION_CACHE} STREQUAL ${CPM_DOWNLOAD_VERSION})
    message(STATUS "CPM.cmake version changed from ${CPM_DOWNLOAD_VERSION_CACHE} to ${CPM_DOWNLOAD_VERSION}")
    set(CPM_DOWNLOAD_VERSION_CACHE ${CPM_DOWNLOAD_VERSION} CACHE STRING "CPM.cmake version" FORCE)
    unset(CPM_DOWNLOAD_LOCATION CACHE)
endif()
set(CPM_DOWNLOAD_LOCATION "${CMAKE_BINARY_DIR}/cmake/CPM_${CPM_DOWNLOAD_VERSION_CACHE}.cmake" CACHE STRING "Location of CPM.cmake")

if(NOT (EXISTS ${CPM_DOWNLOAD_LOCATION}))
    message(STATUS "Downloading CPM.cmake")
    file(DOWNLOAD https://github.com/TheLartians/CPM.cmake/releases/download/v${CPM_DOWNLOAD_VERSION_CACHE}/CPM.cmake ${CPM_DOWNLOAD_LOCATION})
endif()

set(CPM_SOURCE_CACHE ${CMAKE_BINARY_DIR}/CPM-cache/ CACHE STRING "CPM cache folder")
set(CPM_USE_LOCAL_PACKAGES ON CACHE BOOL "Use local packages")
include(${CPM_DOWNLOAD_LOCATION})